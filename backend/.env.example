# =============================================
# Converge-NPS Backend Environment Variables
# =============================================
# Copy this file to .env and fill in your values
# NEVER commit .env to version control!

# =============================================
# Database Configuration
# =============================================
# For local development, use local PostgreSQL
# For Railway/production, use Supabase connection string
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/converge_nps?schema=public"

# Connection pooling (Supabase provides pooled connections)
# Use ?pgbouncer=true for production with Supabase
# DATABASE_URL="postgresql://postgres:[PASSWORD]@db.supabase.co:6543/postgres?pgbouncer=true"

# =============================================
# Redis Configuration
# =============================================
# For local development, use local Redis
# For Railway/production, use Railway Redis URL
REDIS_URL="redis://localhost:6379"

# =============================================
# JWT & Authentication
# =============================================
# IMPORTANT: Generate strong random secrets for production!
# Use: openssl rand -base64 32
JWT_SECRET="your-super-secret-jwt-key-change-this-in-production"
JWT_REFRESH_SECRET="your-super-secret-refresh-key-change-this-in-production"
JWT_EXPIRES_IN="1h"
JWT_REFRESH_EXPIRES_IN="30d"

# Password hashing cost (10-12 recommended, higher = more secure but slower)
BCRYPT_ROUNDS=12

# =============================================
# Server Configuration
# =============================================
PORT=3000
NODE_ENV=development  # development | staging | production

# Frontend URL (for CORS and email links)
FRONTEND_URL="http://localhost:5173"

# API Base URL (for generating links in emails)
API_BASE_URL="http://localhost:3000"

# =============================================
# CORS Configuration
# =============================================
# Comma-separated list of allowed origins
CORS_ORIGIN="http://localhost:5173,http://localhost:3000"

# =============================================
# Email Configuration
# =============================================
EMAIL_FROM="noreply@converge-nps.com"
EMAIL_FROM_NAME="Converge NPS"
EMAIL_PROVIDER="console"  # console | sendgrid | ses

# SendGrid Configuration
SENDGRID_API_KEY=""

# AWS SES Configuration (alternative to SendGrid)
AWS_SES_REGION="us-west-2"
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""

# Email Templates
EMAIL_VERIFY_URL_TEMPLATE="${FRONTEND_URL}/verify-email?token={{token}}"
EMAIL_RESET_URL_TEMPLATE="${FRONTEND_URL}/reset-password?token={{token}}"

# =============================================
# Smartsheet Integration
# =============================================
# Get your API token from: https://app.smartsheet.com/profile
SMARTSHEET_API_KEY=""

# Sheet IDs for data import (from Smartsheet URLs)
# Format: Get the sheet ID from the URL: https://app.smartsheet.com/sheets/{SHEET_ID}
SMARTSHEET_SESSIONS_SHEET_ID=""
SMARTSHEET_PROJECTS_SHEET_ID=""
SMARTSHEET_OPPORTUNITIES_SHEET_ID=""
SMARTSHEET_PARTNERS_SHEET_ID=""
SMARTSHEET_ATTENDEES_SHEET_ID=""

# Sheet IDs for data export
SMARTSHEET_USER_SHEET_ID=""
SMARTSHEET_RSVP_SHEET_ID=""
SMARTSHEET_CONNECTION_SHEET_ID=""
SMARTSHEET_ANALYTICS_SHEET_ID=""

# Sync interval (minutes) - 0 to disable auto-sync
SMARTSHEET_SYNC_INTERVAL=60

# =============================================
# File Upload & Storage (S3 or compatible)
# =============================================
S3_BUCKET="converge-nps-uploads"
S3_REGION="us-west-2"
S3_ENDPOINT=""  # Optional: For S3-compatible services (MinIO, DigitalOcean Spaces)
S3_ACCESS_KEY_ID=""
S3_SECRET_ACCESS_KEY=""

# Upload limits
MAX_FILE_SIZE_MB=5
ALLOWED_FILE_TYPES="image/jpeg,image/png,image/webp,application/pdf"

# =============================================
# Session Management
# =============================================
SESSION_TIMEOUT_MINUTES=30
SESSION_ABSOLUTE_TIMEOUT_HOURS=12
MAX_CONCURRENT_SESSIONS=5

# =============================================
# Rate Limiting
# =============================================
# Global rate limit (per IP)
RATE_LIMIT_WINDOW_MS=3600000  # 1 hour in milliseconds
RATE_LIMIT_MAX_REQUESTS=1000

# Login rate limit (per IP + email)
LOGIN_RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
LOGIN_RATE_LIMIT_MAX_ATTEMPTS=5

# =============================================
# Monitoring & Observability
# =============================================
# Sentry for error tracking
SENTRY_DSN=""
SENTRY_ENVIRONMENT="development"  # development | staging | production
SENTRY_TRACES_SAMPLE_RATE=1.0  # 0.0 to 1.0 (1.0 = 100% of transactions)

# Logging configuration
LOG_LEVEL="info"  # error | warn | info | debug
LOG_FORMAT="json"  # json | pretty

# =============================================
# Security
# =============================================
# CSRF Protection
CSRF_ENABLED=true

# Encryption key for sensitive data (optional, for pgcrypto)
# Generate with: openssl rand -base64 32
ENCRYPTION_KEY=""

# =============================================
# Feature Flags
# =============================================
ENABLE_SMARTSHEET_SYNC=true
ENABLE_EMAIL_NOTIFICATIONS=true
ENABLE_WEBSOCKET=true
ENABLE_QR_SCANNER=true
ENABLE_OFFLINE_MODE=true

# =============================================
# Development & Testing
# =============================================
# Disable auth for testing (NEVER use in production!)
DISABLE_AUTH=false

# Seed database on startup
AUTO_SEED_DATABASE=false

# Mock external services
MOCK_SMARTSHEET=false
MOCK_EMAIL=true
MOCK_S3=false
